#!/bin/sh


mygreen='\e[0;32m'
myblue='\e[0;34m'
myred='\e[1;31m'
myyellow='\e[0;93m'
myreset='\e[m'

alias clear='tput cup 1 0 && tput ed'


function print_header {
	stty size | {
		read y x
		tput sc
	
		tput cup 0 0		
		tput el  # clear line
		
		# hostname to the left of the screen
		TITLE="$(whoami)@$HOSTNAME"
		tput cup 0 0 
		printf "${mygreen}$TITLE${myreset}"
		#printf '%b' "${mygreen}$TITLE${myreset}"
		
		# time in the center of the screen
		D=$(date)
		tput cup "0" "$(( (x - ${#D}) / 2 ))"  
		printf %s "$D"
		
		# battery in the top right of the screen
		BAT="$(cat /sys/class/power_supply/BAT0/capacity 2> /dev/null)"
		BATMSG="Battery $BAT%% "
		tput cup "0" "$(( x - ${#BATMSG} ))" 
		if [[ $BAT -le 10 ]]; then
			printf "${myred}$BATMSG${myreset}"
		elif [[ $BAT -le 40 ]]; then
			printf "${myyellow}$BATMSG${myreset}"
		else
			printf "${mygreen}$BATMSG${myreset}"
		fi
		tput rc
	}
}


function branch_finder {
	M=$(git branch 2> /dev/null | grep \* | sed '{s/*// ; s/ //}') 
	if [[ "$M" != "" ]]; then
		printf "($M)" 
	else
		printf ">"
	fi
}


function git_changes {
	STAT=$(git status -s 2> /dev/null | grep M)
	if [[ "$STAT" != "" ]]; then
		true
	else
		false	
	fi
}

PROMPT_COMMAND=print_header

PS1='\u \['$myblue'\][\w]\['$myreset'\] $(if git_changes; then printf "\[${myyellow}\]$(branch_finder)"; else printf "\[$mygreen\]$(branch_finder)";fi)\['$myreset'\] '









